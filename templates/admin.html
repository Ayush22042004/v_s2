{% extends "base.html" %}
{% block content %}
<h2>Admin Dashboard</h2>

<div class="grid">
  <!-- Schedule Election -->
  <div class="card">
    <h3>Schedule Election</h3>
    <form method="POST" action="{{ url_for('schedule_election') }}">
      <input name="title" placeholder="Election Title" required>
      <label>Year</label>
      <select name="year" required>
        {% for y in range(2023, 2031) %}
          <option value="{{ y }}" {% if y==2025 %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
      <label>Category</label>
      <select name="category" required>
        <option>General</option><option>Technical</option><option>Cultural</option>
      </select>
      <label>Start</label>
      <input type="datetime-local" name="start_time" required>
      <label>End</label>
      <input type="datetime-local" name="end_time" required>
      <label>Candidate limit (optional)</label>
      <input name="candidate_limit" type="number" min="1">
      <button class="btn primary" type="submit">Schedule</button>
    </form>
  </div>

  <!-- Add Candidate -->
  <div class="card">
    <h3>Add Candidate</h3>
    <form method="POST" action="{{ url_for('add_candidate') }}" enctype="multipart/form-data">
      <input name="name" placeholder="Candidate name" required>
      <label>Election</label>
      <select name="election_id" required>
        {% for e in (ongoing + scheduled) %}
          <option value="{{ e.id }}">{{ e.title or e.category }}</option>
        {% else %}
          <option disabled>No eligible election</option>
        {% endfor %}
      </select>
      <input type="file" name="photo" accept="image/*">
      <button class="btn primary" type="submit">Add Candidate</button>
    </form>
  </div>
</div>

<div class="kanban">
  <!-- Ongoing -->
  <div>
    <h3>Ongoing</h3>
    <ul>
      {% for e in ongoing %}
        <li><strong>{{ e.title or e.category }}</strong> • {{ e.start_time|istfmt }} → {{ e.end_time|istfmt }}</li>
      {% else %}
        <li class="muted">None</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Upcoming -->
  <div>
    <h3>Upcoming</h3>
    <ul>
      {% for e in scheduled %}
        <li>{{ e.title or e.category }} • {{ e.start_time|istfmt }}</li>
      {% else %}
        <li class="muted">None</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Ended -->
  <div>
    <h3>Ended</h3>
    <ul>
      {% for e in ended %}
        <li>{{ e.title or e.category }} • {{ e.start_time|istfmt }} → {{ e.end_time|istfmt }}</li>
      {% else %}
        <li class="muted">None</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Results -->
  <div>
    <h3>Results</h3>
    <ul>
      {% for e in ended %}
        <li>{{ e.title or e.category }}
          <a href="{{ url_for('results', election_id=e.id) }}">View Results</a> |
          <a href="{{ url_for('results_excel', eid=e.id) }}">Download Excel</a>
        </li>
      {% else %}
        <li class="muted">No results available</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}