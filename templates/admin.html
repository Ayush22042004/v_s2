{% extends "base.html" %}
{% block content %}

<!-- Admin Dashboard Header -->
<div class="mb-8">
  <div class="glass-effect rounded-2xl p-6 border border-red-500/20">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent mb-2">
          Admin Dashboard
        </h1>
        <p class="text-gray-400">Manage elections, candidates, and view comprehensive analytics</p>
      </div>
      <div class="flex items-center space-x-4">
        <div class="text-right">
          <div class="text-2xl font-bold text-white">{{ elections|length }}</div>
          <div class="text-sm text-gray-400">Total Elections</div>
        </div>
        <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl flex items-center justify-center animate-pulse">
          <i class="fas fa-crown text-white text-lg"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="grid md:grid-cols-4 gap-6 mb-8">
  <a href="{{ url_for('schedule') }}" class="glass-effect rounded-2xl p-6 vote-card transition-all duration-500 border border-blue-500/20 hover:border-blue-400/50 group">
    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
      <i class="fas fa-calendar-plus text-white text-lg"></i>
    </div>
    <h3 class="text-lg font-bold text-white group-hover:text-blue-400 transition-colors">Schedule Election</h3>
    <p class="text-gray-400 text-sm">Create new elections</p>
  </a>

  <a href="{{ url_for('admin_candidate_applications') }}" class="glass-effect rounded-2xl p-6 vote-card transition-all duration-500 border border-purple-500/20 hover:border-purple-400/50 group">
    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
      <i class="fas fa-user-check text-white text-lg"></i>
    </div>
    <h3 class="text-lg font-bold text-white group-hover:text-purple-400 transition-colors">Candidate Applications</h3>
    <p class="text-gray-400 text-sm">Approve candidates</p>
  </a>

  <a href="{{ url_for('admin_voters') }}" class="glass-effect rounded-2xl p-6 vote-card transition-all duration-500 border border-green-500/20 hover:border-green-400/50 group">
    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
      <i class="fas fa-users text-white text-lg"></i>
    </div>
    <h3 class="text-lg font-bold text-white group-hover:text-green-400 transition-colors">Manage Voters</h3>
    <p class="text-gray-400 text-sm">View voter data</p>
  </a>

  <a href="{{ url_for('results') }}" class="glass-effect rounded-2xl p-6 vote-card transition-all duration-500 border border-yellow-500/20 hover:border-yellow-400/50 group">
    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
      <i class="fas fa-chart-bar text-white text-lg"></i>
    </div>
    <h3 class="text-lg font-bold text-white group-hover:text-yellow-400 transition-colors">View Results</h3>
    <p class="text-gray-400 text-sm">Election analytics</p>
  </a>
</div>

<!-- Elections Overview -->
<div class="grid lg:grid-cols-3 gap-8">
  
  <!-- Elections List -->
  <div class="lg:col-span-2 space-y-6">
    
    <!-- Ongoing Elections -->
    <div>
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-circle text-white text-xs animate-pulse"></i>
        </div>
        <h2 class="text-xl font-bold text-white">Ongoing Elections</h2>
        <div class="px-3 py-1 bg-green-500/20 rounded-full text-green-400 text-sm font-medium border border-green-500/30">
          {{ ongoing|length }} Active
        </div>
      </div>
      
      {% for e in ongoing %}
      <div class="glass-effect rounded-2xl p-6 border border-green-500/20 mb-4">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 class="text-lg font-bold text-white">{{ e.title or e.category }}</h3>
            <p class="text-gray-400 text-sm">{{ e.start_time|istfmt }} → {{ e.end_time|istfmt }}</p>
          </div>
          <div class="flex items-center space-x-2">
            <a href="{{ url_for('results', election_id=e.id) }}" class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition-colors">
              View Results
            </a>
          </div>
        </div>
      </div>
      {% else %}
      <div class="glass-effect rounded-2xl p-8 text-center border border-white/10">
        <div class="w-16 h-16 bg-green-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-vote-yea text-green-400 text-xl"></i>
        </div>
        <p class="text-gray-400">No ongoing elections</p>
      </div>
      {% endfor %}
    </div>

    <!-- Scheduled Elections -->
    <div>
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-clock text-white text-sm"></i>
        </div>
        <h2 class="text-xl font-bold text-white">Scheduled Elections</h2>
        <div class="px-3 py-1 bg-blue-500/20 rounded-full text-blue-400 text-sm font-medium border border-blue-500/30">
          {{ scheduled|length }} Upcoming
        </div>
      </div>
      
      {% for e in scheduled %}
      <div class="glass-effect rounded-2xl p-6 border border-blue-500/20 mb-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-bold text-white">{{ e.title or e.category }}</h3>
            <p class="text-gray-400 text-sm">Starts: {{ e.start_time|istfmt }}</p>
          </div>
          <div class="flex items-center space-x-2">
            <span class="px-3 py-1 bg-blue-500/20 rounded-lg text-blue-400 text-sm">Scheduled</span>
          </div>
        </div>
      </div>
      {% else %}
      <div class="glass-effect rounded-2xl p-8 text-center border border-white/10">
        <div class="w-16 h-16 bg-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-calendar text-blue-400 text-xl"></i>
        </div>
        <p class="text-gray-400 mb-4">No scheduled elections</p>
        <a href="{{ url_for('schedule') }}" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-medium transition-all duration-300">
          Schedule New Election
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- Ended Elections -->
    <div>
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-gray-500 to-slate-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-check-circle text-white text-sm"></i>
        </div>
        <h2 class="text-xl font-bold text-white">Completed Elections</h2>
        <div class="px-3 py-1 bg-gray-500/20 rounded-full text-gray-400 text-sm font-medium border border-gray-500/30">
          {{ ended|length }} Completed
        </div>
      </div>
      
      {% for e in ended[:3] %}
      <div class="glass-effect rounded-2xl p-6 border border-gray-500/20 mb-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-bold text-white">{{ e.title or e.category }}</h3>
            <p class="text-gray-400 text-sm">{{ e.start_time|istfmt }} → {{ e.end_time|istfmt }}</p>
          </div>
          <div class="flex items-center space-x-2">
            <a href="{{ url_for('results', election_id=e.id) }}" class="px-3 py-1 bg-gray-600 hover:bg-gray-700 rounded-lg text-white text-sm transition-colors">
              View Results
            </a>
            <a href="{{ url_for('export_excel') }}" class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition-colors">
              Export
            </a>
          </div>
        </div>
      </div>
      {% else %}
      <div class="glass-effect rounded-2xl p-8 text-center border border-white/10">
        <div class="w-16 h-16 bg-gray-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-archive text-gray-400 text-xl"></i>
        </div>
        <p class="text-gray-400">No completed elections yet</p>
      </div>
      {% endfor %}
      
      <!-- View All Past Elections Button -->
      {% if ended|length > 3 %}
      <div class="mt-4 text-center">
        <a href="{{ url_for('past_elections') }}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-gray-600 to-slate-600 hover:from-gray-700 hover:to-slate-700 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
          <i class="fas fa-history mr-2"></i>
          View All Past Elections ({{ ended|length }} total)
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    
    <!-- Quick Stats -->
    <div class="glass-effect rounded-2xl p-6 border border-red-500/20">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-chart-pie text-white text-sm"></i>
        </div>
        <h3 class="text-lg font-bold text-white">System Overview</h3>
      </div>
      
      <div class="space-y-4">
        <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
          <span class="text-gray-400 text-sm">Total Elections</span>
          <span class="font-bold text-red-400">{{ elections|length }}</span>
        </div>
        <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
          <span class="text-gray-400 text-sm">Active Elections</span>
          <span class="font-bold text-green-400">{{ ongoing|length }}</span>
        </div>
        <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
          <span class="text-gray-400 text-sm">Scheduled</span>
          <span class="font-bold text-blue-400">{{ scheduled|length }}</span>
        </div>
        <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
          <span class="text-gray-400 text-sm">Completed</span>
          <span class="font-bold text-gray-400">{{ ended|length }}</span>
        </div>
      </div>
    </div>

    <!-- Add Candidate Form -->
    <div class="glass-effect rounded-2xl p-6 border border-purple-500/20">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-user-plus text-white text-sm"></i>
        </div>
        <h3 class="text-lg font-bold text-white">Quick Add Candidate</h3>
      </div>
      
      <form method="POST" action="{{ url_for('add_candidate') }}" enctype="multipart/form-data" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Candidate Name</label>
          <input 
            name="name" 
            required
            placeholder="Enter candidate name"
            class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg focus:border-purple-500/50 focus:outline-none transition-all duration-300 text-white text-sm placeholder-gray-400"
          >
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Category</label>
          <input 
            name="category" 
            placeholder="e.g., President, Secretary"
            class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg focus:border-purple-500/50 focus:outline-none transition-all duration-300 text-white text-sm placeholder-gray-400"
          >
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Election</label>
          <select 
            name="election_id" 
            required
            class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg focus:border-purple-500/50 focus:outline-none transition-all duration-300 text-white text-sm"
          >
            <option value="">Select Election</option>
            {% for e in elections %}
            <option value="{{ e.id }}">{{ e.title or e.category }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Photo (Optional)</label>
          <input 
            type="file" 
            name="photo" 
            accept="image/*"
            class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg focus:border-purple-500/50 focus:outline-none transition-all duration-300 text-white text-sm"
          >
        </div>
        
        <button 
          type="submit"
          class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 text-sm"
        >
          Add Candidate
        </button>
      </form>
    </div>

    <!-- Recent Activity -->
    <div class="glass-effect rounded-2xl p-6 border border-blue-500/20">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center">
          <i class="fas fa-activity text-white text-sm"></i>
        </div>
        <h3 class="text-lg font-bold text-white">Recent Activity</h3>
      </div>
      
      <div class="space-y-3 text-sm">
        {% if last_schedule_debug %}
        <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg">
          <div class="font-medium text-blue-400">Last Scheduled Election</div>
          <div class="text-gray-400 mt-1">
            UTC: {{ last_schedule_debug.get('utc_start', 'N/A') }}
          </div>
        </div>
        {% endif %}
        
        <div class="p-3 bg-white/5 rounded-lg">
          <div class="text-gray-300">System Status: <span class="text-green-400 font-medium">Online</span></div>
        </div>
        
        <div class="p-3 bg-white/5 rounded-lg">
          <div class="text-gray-300">Last Update: <span class="text-blue-400 font-medium">Just now</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Actions -->
<div class="mt-8 flex flex-wrap gap-4 justify-center">
  <a href="{{ url_for('export_excel') }}" class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
    <i class="fas fa-download mr-2"></i>Export All Data
  </a>
  
  <button onclick="refreshDashboard()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
    <i class="fas fa-sync-alt mr-2"></i>Refresh Dashboard
  </button>
  
  <a href="{{ url_for('schedule') }}" class="px-6 py-3 border border-white/20 hover:bg-white/10 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
    <i class="fas fa-plus mr-2"></i>New Election
  </a>
</div>

<script>
function refreshDashboard() {
  showToast('Refreshing dashboard...');
  setTimeout(() => {
    location.reload();
  }, 1000);
}

// Auto-refresh dashboard every 2 minutes
setInterval(() => {
  fetch(window.location.href)
    .then(response => response.text())
    .then(() => {
      console.log('Dashboard auto-refreshed');
    })
    .catch(console.error);
}, 120000);
</script>

{% endblock %}