{% extends "base.html" %}
{% block content %}

<div class="max-w-7xl mx-auto">
  
  <!-- Past Elections Header -->
  <div class="mb-8">
    <div class="glass-effect rounded-2xl p-6 border border-gray-500/20">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-gray-400 to-slate-400 bg-clip-text text-transparent mb-2">
            Past Elections Archive
          </h1>
          <p class="text-gray-400">Complete history of all completed and cancelled elections</p>
        </div>
        <div class="flex items-center space-x-4">
          <div class="text-right">
            <div class="text-2xl font-bold text-white">{{ total_count }}</div>
            <div class="text-sm text-gray-400">Total Elections</div>
          </div>
          <div class="w-12 h-12 bg-gradient-to-r from-gray-500 to-slate-500 rounded-xl flex items-center justify-center animate-pulse">
            <i class="fas fa-archive text-white text-lg"></i>
          </div>
        </div>
      </div>
      
      <!-- Back to Admin Button -->
      <div class="mt-4">
        <a href="{{ url_for('admin') }}" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition-colors">
          <i class="fas fa-arrow-left mr-2"></i>
          Back to Admin Dashboard
        </a>
      </div>
    </div>
  </div>

  <!-- Elections List -->
  <div class="space-y-6">
    {% for election in elections %}
    <div class="glass-effect rounded-2xl p-6 border border-gray-500/20 hover:border-gray-400/30 transition-all duration-300">
      <div class="flex items-start justify-between mb-4">
        <div class="flex-1">
          <div class="flex items-center space-x-3 mb-2">
            <h3 class="text-xl font-bold text-white">{{ election.title or election.category }}</h3>
            {% if election.status == 'cancelled' %}
            <span class="px-3 py-1 bg-red-500/20 border border-red-500/30 rounded-full text-red-400 text-xs font-medium">
              <i class="fas fa-times-circle mr-1"></i>
              Cancelled
            </span>
            {% else %}
            <span class="px-3 py-1 bg-green-500/20 border border-green-500/30 rounded-full text-green-400 text-xs font-medium">
              <i class="fas fa-check-circle mr-1"></i>
              Completed
            </span>
            {% endif %}
          </div>
          
          <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-400">
            <div class="flex items-center space-x-2">
              <i class="fas fa-calendar text-blue-400"></i>
              <span>{{ election.start_time|istfmt }} â†’ {{ election.end_time|istfmt }}</span>
            </div>
            <div class="flex items-center space-x-2">
              <i class="fas fa-users text-purple-400"></i>
              <span>{{ election.candidate_count }} candidates</span>
            </div>
            <div class="flex items-center space-x-2">
              <i class="fas fa-vote-yea text-green-400"></i>
              <span>{{ election.vote_count }} total votes</span>
            </div>
            {% if election.cancelled_at %}
            <div class="flex items-center space-x-2">
              <i class="fas fa-clock text-red-400"></i>
              <span>Cancelled: {{ election.cancelled_at|istfmt }}</span>
            </div>
            {% endif %}
          </div>
          
          {% if election.category %}
          <div class="mt-3">
            <span class="px-2 py-1 bg-white/5 rounded-lg text-xs text-gray-400">
              {{ election.category }}
            </span>
          </div>
          {% endif %}
        </div>
        
        <!-- Action Buttons -->
        <div class="flex items-center space-x-2 ml-4">
          <a href="{{ url_for('results', election_id=election.id) }}" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white text-sm transition-colors">
            <i class="fas fa-chart-bar mr-2"></i>
            View Results
          </a>
          <a href="{{ url_for('results_excel', eid=election.id) }}" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition-colors">
            <i class="fas fa-download mr-2"></i>
            Export Excel
          </a>
        </div>
      </div>
      
      <!-- Election Stats Bar -->
      <div class="mt-4 pt-4 border-t border-white/10">
        <div class="flex items-center justify-between text-xs text-gray-400">
          <span>Election ID: #{{ election.id }}</span>
          {% if election.year %}
          <span>Year: {{ election.year }}</span>
          {% endif %}
          <span>Created: {{ election.start_time|istfmt }}</span>
        </div>
      </div>
    </div>
    {% else %}
    <div class="glass-effect rounded-2xl p-12 text-center border border-white/10">
      <div class="w-24 h-24 bg-gray-500/20 rounded-3xl flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-archive text-gray-400 text-3xl"></i>
      </div>
      <h3 class="text-xl font-bold text-white mb-2">No Past Elections</h3>
      <p class="text-gray-400">No completed or cancelled elections found in the system.</p>
    </div>
    {% endfor %}
  </div>
  
  <!-- Summary Stats -->
  {% if elections %}
  <div class="mt-8 glass-effect rounded-2xl p-6 border border-blue-500/20">
    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
      <i class="fas fa-chart-pie mr-2 text-blue-400"></i>
      Archive Summary
    </h3>
    <div class="grid md:grid-cols-4 gap-6">
      <div class="text-center">
        <div class="text-2xl font-bold text-blue-400">{{ total_count }}</div>
        <div class="text-sm text-gray-400">Total Elections</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold text-green-400">{{ elections|selectattr('status', 'ne', 'cancelled')|list|length }}</div>
        <div class="text-sm text-gray-400">Completed</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold text-red-400">{{ elections|selectattr('status', 'equalto', 'cancelled')|list|length }}</div>
        <div class="text-sm text-gray-400">Cancelled</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold text-purple-400">{{ elections|sum(attribute='vote_count') }}</div>
        <div class="text-sm text-gray-400">Total Votes</div>
      </div>
    </div>
  </div>
  {% endif %}

</div>

<script>
// Auto-refresh every 5 minutes for updated data
setInterval(() => {
  if (document.visibilityState === 'visible') {
    location.reload();
  }
}, 300000);
</script>

{% endblock %}